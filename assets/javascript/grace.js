/*! grace v1.0.0 xdf 2014-04-11 13:57:51 */

!function(a,b){"use strict";return"function"==typeof define&&define.amd?define(["exports"],b):"undefined"!=typeof exports?b(exports):void b(a.grace||(a.grace={}))}(this,function(a){function b(){}function c(a){return function(b){return Object.prototype.toString.call(b)==="[object "+a+"]"}}function d(a){this.source=a.source,this.init()}function e(){var a=arguments;k.log("render template"),a[2]&&config(a[2]);a[0],a[1]}function f(a,b){var c=new d({source:b}).init().toString();return new Function("$data",c)}function g(){var a,b,c=arguments;k.log("source compile"),c[1]?c[2]?(b=c[1],a=c[0]):k.isString(c[1])?(b=c[1],a=c[0]):b=c[0]:b=c[0];try{return f(a,b)}catch(d){d.id=a||b,d.name="Syntax Error"}}function h(){this.cache={}}function i(){switch(arguments.length){default:case 0:return k.log("parameter error");case 1:return compile.apply(this,arguments);case 2:case 3:return render.apply(this,arguments)}}function j(a){k.mix(x,a)}var k,l="",m={WRAP:"\n",BLANK:" "},n=function(){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"}},o=/(?:^|\n)if\s+\S+/,p=/(?:^|\n)else\s*/,q=/(?:^|\n)elseif\s+\S+.*/,r=/(?:^|\n)each\s+\S+\s+in\s+\S+/,s=/\=*\s*\$\w+([\.]\w+)*\s*/,t=(new RegExp(""),/\s*stop\s*/),u=/(?:^|\n)#[^\n]*/,v=/(?:^|\n)\/(each|if)\s*/,w=/\$[\w\d]+/g;b.prototype={log:function(a){console&&this.isObject(console.log)&&console.log(a)},indexOf:function(a,b){return!!~b.indexOf(a)},mix:function(a,b){for(var c in b)a[c]=b[c];return a},each:function(a,b){if(a){for(var c in a)"length"!==c&&"item"!==c&&a.hasOwnProperty(c)&&b.call(this,a[c],c);return a}},isString:function(){return c("String")},isObject:function(){return c("Object")},trim:function(a){return a.replace(/(^\s*)|(\s*$)/g,l)},escape:function(a){return this.each(n(),function(b,c){a=a.replace(new RegExp(c,"g"),b)}),a},unEscape:function(a){return this.each(n(),function(b,c){a=a.replace(new RegExp(b,"g"),c)}),a}},k=new b,d.prototype={init:function(){var a=this;return a.code=l,a.scanner(),a.build(),a.compass(),a.code},scanner:function(){var a=this,b=a.source,c=x.tags.open,d=x.tags.close;k.each(b.split(c),function(b){b=b.split(d);var c=b[0],e=b[1];1==b.length?a.code+=a.parseStatic(c):(a.code+=a.parseLogic(c),e&&(a.code+=a.parseStatic(e)))})},compass:function(){x.compress},build:function(){function a(a){var b="var _ = _||{};_.each="+k.each.toString()+";_.escape="+k.escape.toString()+";"+m.WRAP;return b+a}var b=this;this.code='"use strict";'+m.WRAP+"var $out = '';"+m.WRAP+a(b.code)+m.WRAP+"return $out;"+m.WRAP},filter:function(a){return a.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")},parseLogic:function(a){var b=l;if(o.test(a))b="if("+k.trim(k.trim(a).split("if")[1].replace(w,function(a){return"$data."+a.split("$")[1]}))+"){";else if(q.test(a))b="}else if("+k.trim(k.trim(a).split("elseif")[1].replace(w,function(a){return"$data."+a.split("$")[1]}))+"){";else if(p.test(a))b="}else{";else if(r.test(a)){var c=k.trim(a).split(" "),d=c[1].split(",")[0],e=c[1].split(",")[1];b="_.each(",b+="$data."+c[3].split("$")[1],b+=",function(",b+=d,e&&(b+=","+e),b+="){"+m.WRAP,b+="var $data = {};"+m.WRAP,b+="$data."+d+" = "+d+";"+m.WRAP,e&&(b+="$data."+e+" = "+e+";"+m.WRAP)}else s.test(a)?b=k.indexOf("=",a)?"$out += "+k.escape("$data."+a.split("=")[1].split("$")[1])+";":"$out += $data."+a.split("$")[1]+";":t.test(a)?b="return $out;":u.test(a)?x.compress||(b="//"+k.trim(a).split("#")[1]):v.test(a)?(b="}",k.indexOf("each",a)&&(b+=");")):k.log("error -----------"+a+"-------------");return b+m.WRAP},parseStatic:function(a){var b=this;return"$out += '"+b.filter(a)+"';"+m.WRAP}},h.prototype={get:function(a){return this.cache[a]?this.cache[a]:null},set:function(a,b){this.cache[a]=b}};var x=(new h,{cache:!0,escape:!0,tags:{open:"<#",close:"#>"},compress:!0,debug:!1});a.version="1.0.0",a._=k,a.config=j,a.render=e,a.compile=g,a.template=i});
